<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="/static/Css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/static/Css/bootstrap-responsive.css" />
    <link rel="stylesheet" type="text/css" href="/static/Css/style.css" />
    <link rel="stylesheet" type="text/css" href='/static/Css/agentsystem-admin.css'/>

    <script type="text/javascript" src="/static/Js/jquery.js"></script>
     <script type="text/javascript" src="/static/Js/bootstrap.js"></script>
    <script type="text/javascript" src="/static/Js/ckform.js"></script>
    <script type="text/javascript" src="/static/Js/common.js"></script>
    <script type="text/javascript" src="/static/Js/ajaxfileupload.js"></script>

    <!--编辑器多图片上传引入开始-->
    <script src="/static/kindeditor/kindeditor-all.js " type="text/javascript"></script>
    <script src="/static/kindeditor/lang/zh-CN.js " type="text/javascript"></script>
    <!--编辑器多图片上传引入结束-->
    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }
        /*.file-input{*/
            /*width: 700px;*/
            /*height: 400px;*/
        /*}*/
         li { margin:7px; padding:5px; float:left; width:100px; height:50px; }

        .agency_reward{
            width: 20px;
            height: 10px;
        }
        .imgBox{max-width: 100px;
            max-height: 100px;
            position: relative;
            margin-top: 16px;
            margin-right: 12px;}
        .imgBox .imgClose{position: absolute;right: -9px;top: -10px;}
    </style>
</head>
<body>
<div id="performance-top">
    <h5> 编辑产品-产品ID：{$data.id} </h5>
</div>

<form action="{:url('/admin/Productmanagement/saveEdit/' )}" method="post" class="definewidth" class=".form-inline">
    <div id="performance-top">
        <h6>基本信息</h6>
        <table class="table table-bordered table-hover m10">
            <tr>
                <td class="tableleft"><span style="color:red;">*</span>产品名称</td>
                <td class="productName"><input required type="text" value="{$data.product_name}" name="product_name" maxlength="50"/><span style="color:red;font-size: 12px;">产品名称最多50个字符</span></td>
            </tr>
            <tr>
                <td width="10%" class="tableleft"><span style="color:red;">*</span>产品类目</td>
                <td class="tl" colspan="5">
                    <select name="type_id" id="type_id" onchange='showProduct(this,"s_id")' >
                        <option selected = "selected">请选择</option>
                        {$typeList}
                    </select>
                    <select  name="s_id" id="s_id" onchange='showProduct(this,"t_id")' {if condition= "empty($secondList['str']) && empty($data.category_id)"}disabled{/if}>

                    {if condition="!empty($secondList['str'])"}
                    {$secondList['str']}
                    <input type="hidden" id="flags" value="1">
                    {/if}
                    </select>
                    <select name="t_id" id="t_id" onchange='showProduct(this,"f_id")' {if condition= "empty($threeList['str']) && empty($secondList['level'])"}disabled{/if} >

                    {if condition="!empty($threeList['str'])"} {$threeList['str']}
                    <input type="hidden" id="flagt" value="1">
                    {/if}
                    </select>
                    <select name="f_id" id="f_id" onchange='showProduct(this,"end")'{if condition= "empty($fourList['str']) && empty($threeList['level'])"}disabled{/if}>
                     {if condition="!empty($fourList['str'])"} {$fourList['str']}\
                    <input type="hidden" id="flagf" value="1">
                    {/if}
                    </select>
                </td>
            </tr>
            <tr>
                <td class="tableleft">产品分组</td>
                <td colspan="5">
                    <div class="col-md-12 col-xs-12">
                        <!--<button type="text" class="btn btn-success btn-lg" id="submit">选择(更多)</button>-->
                        <a href="#" id="submit" style="cursor:hand;color: #0a9a52;">选择(更多)</a>
                    </div>
                    <div class="col-md-12 col-xs-12 main"  style=" {if condition="empty($grouping_id)"} display: none;   {/if} ">
                        <ul class="grouping_name">
                            {foreach $grouping_data as $k=>$vo}
                                 <li style="list-style-type:none;">
                                    <input {if condition="in_array($vo['id'],$grouping_id)"}  checked="checked"  {/if} type="checkbox"  name="checkbox[]" value="{$vo.id}">
                                     {$vo.grouping_name}
                                 </li>
                            {/foreach}
                        </ul>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="tableleft">产品标签</td>
                <td colspan="5">
                    <div class="col-md-12 col-xs-12">
                        <!--<button type="button" class="btn btn-success btn-lg" id="button">选择(更多)</button>-->
                        <a href="#" id="button" style="color: #0a9a52">选择(更多)</a>
                    </div>
                    <div class="col-md-12 col-xs-12 main1"  style="{if condition="empty($level_id)"} display: none;   {/if}">
                        <ul class="grouping_name">
                            {foreach $label_data as $k=>$v}
                              <li style="list-style-type:none;">
                                     <input type="checkbox"  {if condition="in_array($v['id'],$level_id)"}  checked="checked"  {/if}  name="checkbox1[]" value="{$v.id}" >
                                  {$v.product_name}
                                  <!--<input type="checkbox" id="selectall" onclick="selectall()" style="width: 1%" value=" " name="label">-->
                             </li>
                            {/foreach}
                        </ul>

                    </div>
                </td>
            </tr>
            <tr>
                <td class="tableleft">封面图片</td>
                <td class="tl" colspan="5">
                    <input type="button" id="pic" value="选择图片" />
                    <div {notpresent name="data.product_img"} style="display:none" {/notpresent} id="pic_img_div">
                        <img id="pic_img" src="{present name="data.product_img"}{$data.product_img}{/present}" width="100px" height="100px">
                    </div>
                    <input type="hidden" name="pic_url" id="pic_url" value="{present name="data.product_img"}{$data.product_img}{/present}">
                </td>
            </tr>
            <tr>
                <td class="tableleft">封面简介<br/><span style="color:red;font-size: 12px;">（建议控制在50个字符以内）</span></td>
                <td colspan="5">
                    <textarea id="fizhi" name="explain" class="explain" style="width: 100%;height: 200px;">{$data.explain} </textarea>
                </td>
            </tr>
            <tr>
                <td class="tableleft">产品图片</td>
                <td class="tl" colspan="5">
                    <input type="button" id="J_selectImage" value="批量上传" />
                    <div id="J_imageView">
                        {foreach $info_arr as $k=>$v}
                        <img src="{$v.img}" alt="" style="width: 100px;height: 100px;">
                        {/foreach}
                    </div>
                    <input type="hidden" value="0" name="img_sing" id="img_sing">
                </td>
            </tr>
            <tr>
                <td class="tableleft"><span style="color:red;">*</span>产品属性</td>
                <td class="tl" colspan="5">
                    销售价:￥<input type="text" required name="sales_price" id="sales_price" style="width: 100px" value="{$data.sales_price}">元&nbsp;&nbsp;&nbsp;&nbsp;
                    成本价:￥<input type="text" required name="cost_price" id="cost_price" style="width: 100px" value="{$data.cost_price}">元&nbsp;&nbsp;&nbsp;&nbsp;
                    单位:<input type="text" name="unit" id="unit" style="width: 100px" value="{$data.unit}">&nbsp;&nbsp;&nbsp;&nbsp;
                    重量:<input type="text" name="weight" id="weight" style="width: 100px" value="{$data.weight}">kg&nbsp;&nbsp;&nbsp;&nbsp;
                    库存:<input type="text" required pattern="^\d+(\.{0,1}\d+){0,1}$"  title="库存不能为负数" name="inventory" id="inventory" style="width: 100px" value="{$data.inventory}">&nbsp;&nbsp;&nbsp;&nbsp;
                    售出:<input type="text" required pattern="^\d+(\.{0,1}\d+){0,1}$"  title="售出不能为负数" name="false_volume" id="false_volume" style="width: 100px" value="{$data.false_volume}">
                </td>
            </tr>
            <tr>
                <td class="tableleft">是否首单商品</td>
                <td class="tl m10 good_layout">
                    <table>
                        <tr>
                            <td>
                                <div class="reward-layout">
                                  <input type="checkbox" id="toggle_is_first_order" name="is_first_order" {if condition="$data.is_first_order eq 1"}  checked="checked" {/if} >
                                    <label for="toggle_is_first_order" class="button-label">
                                        <span class="button-circle"></span>
                                        <span class="text on">是</span>
                                        <span class="text off">否</span>
                                    </label>
                                </div>
                            </td>
                            <td class="tableleft" width="10%">是否礼包商品</td>
                            <td class="tl m10">
                                <div class="reward-layout">
                                    <input type="checkbox" id="toggle_is_gift" name="is_gift"  {if condition="$data.is_gift eq 1"}  checked="checked" {/if} >
                                    <label for="toggle_is_gift" class="button-label">
                                        <span class="button-circle"></span>
                                        <span class="text on">是</span>
                                        <span class="text off">否</span>
                                    </label>
                                </div>
                            </td>
                            <td class="tableleft">限购一件</td>
                            <td class="tl m10" >
                                <div class="reward-layout">
                                    <input type="checkbox" id="toggle_is_Purchase_a" name="is_Purchase_a" {if condition="$data.is_Purchase_a eq 1"}  checked="checked" {/if}  >
                                    <label for="toggle_is_Purchase_a" class="button-label">
                                        <span class="button-circle"></span>
                                        <span class="text on">是</span>
                                        <span class="text off">否</span>
                                    </label>
                                </div>
                            </td>
                           
                        </tr>
                    </table>
                </td>
                <!-- <td class="tableleft" width="10%" style="display:none;">是否包邮</td>
                <td class="tl m10" style="display:none;">
                    <div class="reward-layout">
                       <input type="checkbox" id="toggle_exemption_from_postage" name="exemption_from_postage" {*if condition="$data.exemption_from_postage eq 1"*} checked="checked" {*/if*}>
                        <label for="toggle_exemption_from_postage" class="button-label">
                            <span class="button-circle"></span>
                            <span class="text on">是</span>
                            <span class="text off">否</span>
                        </label>
                    </div>
                </td> -->
            </tr>
            <tr>
                <td class="tableleft">选择运费模板</td>
                <td class="tl" colspan="5">
                    <select name="express">
                        <option value="">请选择</option>
                        {foreach name='express' id='eachE'}
                        <option value="{$eachE.id}" {eq name="$eachE.id" value="$data.express"}selected='selected'{/eq}>{$eachE.name}</option>
                        {/foreach}
                    </select>
                </td>
            </tr>
         	 <tr>
                <td class="tableleft">代理商身份</td>
                <td class="tl" colspan="5">
                        <h7>
                                注明：此为商品标签：默认为【普通】即为普通商品，如需要设置升级商品，请选择目标身份。（例如：需要设置【精英顾问】，此处选择【精英顾问】）
                            </h7>
                    <div class="reward-layout">
                        <select name="is_agent_level" id="is_agent_level">
                            <option value="0">普通</option>
                            {foreach name='listLevel' item="item"}
                            <option value='{$item.id}'  {eq name="$item.id" value="$data.is_agent_level"}selected='selected'{/eq}>{$item.name}</option>
                            {/foreach}
                        </select>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    {if condition="$config->valid_recommend_reward eq 1"}
    <div id="performance-top">
            <h6> 招商奖励设置</h6>
            <h7>（填写0则不奖励，填写-1则按【奖励机制】中招商奖励系数值计算）</h7>
            <table class="table table-bordered table-hover m10">
                    <tr>
                            <td width="10%" class="tableleft">角色</td>
                            <td width="15%" class="tableleft">一度招商奖励系数</td>
                            <td width="15%" class="tableleft">二度招商奖励系数</td>
                            <td width="15%" class="tableleft">三度招商奖励系数</td>
                            <td width="15%" class="tableleft">四度招商奖励系数</td>
                            <td width="15%" class="tableleft">五度招商奖励系数</td>
                            <td width="15%" class="tableleft">六度招商奖励系数 </td>
                    </tr>
                    {foreach name="listLevel" item="kk"}
                    <tr {if condition='$kk.deep eq 0'} style="display:none;"{/if} >
                    <td class="tableleft tr" width="10%">{$kk.name}</td>
                        {for start="0" end="$kk.deep"}
                         <td  width="15%" class="tl"   {if condition='$i eq $kk.deep-1'} colspan="{$deep=abs($kk.deep-7)}" {else/}{/if}>
                             <input  type="hidden" class="input-medium"  name="id_{$kk.id}_{$i+1}" value="{present name="kk['roleRatioId'][$i+1]"}{$kk['roleRatioId'][$i+1]}{/present} " >
                            <input  style="width:130px;" type="text" required pattern="^(\d?\d(\.\d*)?|100|-1)$"  title="必须在0和100之间或者-1" class="form-control" id="exampleInputName2" name="value_{$kk.id}_{$i+1}" value="{present name="kk['roleRatioValue'][$i+1]"}{$kk['roleRatioValue'][$i+1]}{/present}" placeholder="{$i+1}度推荐奖励" >
                        </td>
                            {/for}
                    </tr>
                    {/foreach}

            </table>
    </div>
    {/if}
    {if condition="$config->valid_agency_reward eq 1"}
    <div id="performance-top">
            <h6>
                代理奖励系数设置
            </h6>
            <h7>
                （填写0则不奖励，填写-1则按【奖励机制】中代理奖励系数值计算）
            </h7>
            <table class="table table-bordered table-hover common_input m10">
                <tr>
                    <td class="tableleft">角色</td>
                    <td class="tableleft">代理奖励系数</td>
                </tr>
                {foreach $agencyList as $k=>$v}
               <tr>
                    <td class="tableleft tr" width="10%" >{$v.name}</td>
                    <td class="tl" >
                      <input  type="hidden" class="input-medium" name="role_{$v.id}" value="{$v.id}">
                      <input  type="hidden" class="input-id" name="aid_{$v.id}" value="{present name="v['agency_id']"}{$v.agency_id}{/present}">
                      <input style="width: 150px;" type="text" required pattern="^(\d?\d(\.\d*)?|100|-1)$"  title="必须在0和100之间或者-1" class="form-control" id="exampleInputName2" name="value_{$v.id}" value="{present name="v['agent_reward']"}{$v.agent_reward}{/present}">
                    </td>
                </tr>
              {/foreach}
            </table>
    </div>
    {/if}
    <div id="performance-top">
            <h6>详细说明</h6>
                <textarea id="editor_id" name="content" style="width:100%;height:300px;">
                {$data.details}
                </textarea>

    </div>
    <div id="performance-top">
            <h6>产品规格</h6>
              <textarea id="editor2" name="content2" style="width:100%;height:300px;">{$data.specification}</textarea>
     </div>
     <div id="performance-top" class=" button-center">

             <input type="hidden" name="id" id="id" value="{$data.id}">
            <button type="submit" class="btn btn-primary m10" type="button">保存</button>
            &nbsp;&nbsp;
            <a href="{:url('/admin/Productmanagement/index')}" class="btn btn-success m10" >返回</a>
     </div>
    <input type="hidden" name="oneId" id="oneId" value="{$categoryID}">
</form>


</body>
</html>


<!--编辑器开始-->
<script>
    KindEditor.ready(function(K) {
        window.editor = K.create('#editor_id');
    });
</script>
<!--封面图片上传-->
<script>
    KindEditor.ready(function(K) {
        window.editor = K.create('#description');

        K('#pic').click(function() {
            editor.loadPlugin('image', function() {
                editor.plugin.imageDialog({
                	showRemote : false,
                    imageUrl : K('#pic_url').val(),
                    clickFn : function(url, title, width, height, border, align) {
                        K('#pic_url').val(url);
                        $('#pic_img').attr('src',url);
                        $('#pic_img_div').show();
                        editor.hideDialog();
                    }
                });
            });
        });

    });
</script>
<script>
    KindEditor.ready(function(K) {
        window.editor = K.create('#editor2');

        K('#J_selectImage').click(function() {
            editor.loadPlugin('multiimage', function() {
                editor.plugin.multiImageDialog({
                    clickFn : function(urlList) {
                        var div = K('#J_imageView');
                        div.html('');
                        K.each(urlList, function(i, data) {
                            div.append('<div class="imgBox"><img id="+data.url+" width=100px height=100px src="' + data.url + '"><img onclick="del(this)" class="imgClose" src="/static/Images/clear.png" alt=""></div>');

                            //把图片路径传递下
                            var imgStr=$('#img_sing').val();
                            if(imgStr==0) {
                                imgStr=data.url;
                            } else {
                                imgStr+="|"+data.url;
                            }
                            $('#img_sing').val(imgStr);

                        });
                        editor.hideDialog();
                    }
                });
            });
        });

    });
</script>
<!--编辑器结束-->

<script>

    $(function () {
		$('#backid').click(function(){
				window.location.href="index.html";
		 });
    });
    function myfun(){
        var o=$("#oneId").val();
        var s=$("#flags").val();
        var t=$("#flagt").val();
        var f=$("#flagf").val();
        if(o!=0){
            if( !s &&!t && !f){
                $("#type_id").change();
            }
            if(s &&!t && !f){
                $("#s_id").change();
            }
            if(t && !f){
                $("#t_id").change();
            }
            if(f){
                $("#f_id").change();
            }
        }



    }
    window.onload=myfun;//不要括号
    //删除图片
    function del(imgFlag) {
        var src = $(imgFlag).siblings('img').attr('src');
        $(imgFlag).siblings('img').hide();
        var imgStr=$('#img_sing').val();
        var tmpstr=imgStr.replace(src,'');
        $('#img_sing').val(tmpstr);
    }
</script>
<script>

    function showProduct(obj,nid) {
        var id=obj.id;
        var idvalue=$('#'+obj.id).val();
        switch(id){
            case 'type_id':
                $('#one_id').val(idvalue);
                $("#s_id").attr('disabled','disabled');
                $("#s_id").empty();
                $("#t_id").attr('disabled','disabled');
                $("#t_id").empty();
                $("#f_id").attr('disabled','disabled');
                $("#f_id").empty();
                break;
            case 's_id':
                $('#two_id').val(idvalue);
                $("#t_id").attr('disabled','disabled');
                $("#t_id").empty();
                $("#f_id").attr('disabled','disabled');
                $("#f_id").empty();
                break;
            case 't_id':
                $('#three_id').val(idvalue);
                $("#f_id").attr('disabled','disabled');
                $("#f_id").empty();
                break;
            case 'f_id': $('#four_id').val(idvalue);break;
        }
        $.ajax({
            type:"post",
            url:"/admin/Productcategory/getCategory/",
            data:{cid:idvalue},
            success:function(e){
                var jsonData = JSON.parse(e);
                if(e){

                    var strHtml='<option value="请选择" >请选择</option>';
                    $.each(jsonData,function(index,val){
                        strHtml+='<option value="'+val.id+'" >'+val.category_name+'</option>';
                    });
                    if(nid!='end'){
                        $("#"+nid).empty().html(strHtml);
                        $("#"+nid).removeAttr('disabled');
                    }

                }else{
                    if(nid!='end'){
                        $("#"+nid).empty();
                        $("#"+nid).attr('disabled','disabled');
                    }
                }
            }
        });
    }


</script>
<!--分组和标签展示-->
<script>

    $(function(){
        $("#submit").click(function(){
            $(".main").toggle();
        });
//            $("#two_id").hide();
//            $("#three_id").hide();
//            $("#four_id").hide();
    })
    $(function(){
        $("#button").click(function(){
            $(".main1").toggle();
        });
    })
</script>
